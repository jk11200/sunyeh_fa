<!DOCTYPE HTML>
<html>

<head>
	<meta name="viewport" content="width=320; user-scalable=no" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Auth Demo</title>
	<link rel="stylesheet" href="jquery.mobile/jquery.mobile-1.0rc2.css" type="text/css" charset="utf-8" />
	<script type="text/javascript" src="js/jquery-1.7.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/phonegap-1.2.0.js"></script>
	<script src="jquery.mobile/jquery.mobile-1.0rc2.js"></script>
	
</head>

<body onload="init()">
	
<div id="loginPage" data-role="page">

	<div data-role="header">
		<h1>Auth Demo</h1>
	</div>

	<div data-role="content">	

		<form id="loginForm">
		<div data-role="fieldcontain" class="ui-hide-label">
			<label for="username">Username:</label>
			<input type="text" name="username" id="username" value="" placeholder="Username" />
		</div>

		<div data-role="fieldcontain" class="ui-hide-label">
			<label for="password">Password:</label>
			<input type="password" name="password" id="password" value="" placeholder="Password" />
		</div>

		<input type="submit" value="Login" id="submitButton">
		</form>
		
	</div>

	<div data-role="footer">
		<h4>Â© Camden Enterprises</h4>
	</div>

</div>

<script>
    $("#loginPage").live("pageinit", function(e) {
		checkPreAuth();
	});
	
	
	function init() {
    document.addEventListener("deviceready", deviceReady, true);
    delete init;
}


function checkPreAuth() {
	var form = $("#loginForm");
	if(window.localStorage["username"] != undefined && window.localStorage["password"] != undefined) {
		$("#username", form).val(window.localStorage["username"]);
		$("#password", form).val(window.localStorage["password"]);
		handleLogin();
	}
}

function handleLogin() {
	var form = $("#loginForm");	
	//disable the button so we can't resubmit while we wait
	$("#submitButton",form).attr("disabled","disabled");
	var u = $("#username", form).val();
	var p = $("#password", form).val();
	console.log("click");
	if(u != '' && p!= '') {
		$.post("https://192.168.1.99:433/MagicScripts/MGrqispi.dll?appname=emis_fa&prgname=Login&arguments=,-AA,-AW20190614500", function(res) {
			if(res == true) {
				//store
				window.localStorage["username"] = u;
				window.localStorage["password"] = p;        			
				$.mobile.changePage("some.html");
			} else {
				navigator.notification.alert("Your login failed", function() {});
			}
	    	$("#submitButton").removeAttr("disabled");
		},"json");
	} else {
		//Thanks Igor!
		navigator.notification.alert("You must enter a username and password", function() {});
		$("#submitButton").removeAttr("disabled");
	}
	return false;
}

function deviceReady() {
	
    $("#loginForm").on("submit",handleLogin);

}
</script>

</body>
</html>